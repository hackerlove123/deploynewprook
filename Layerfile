# This is an example webapp.io configuration for a VM!
FROM vm/ubuntu:22.04

# Cập nhật hệ thống và cài đặt các package cần thiết
RUN apt update -y && apt install -y --no-install-recommends \
    bash curl git htop speedtest-cli python3-pip supervisor \
    && pip3 install requests python-telegram-bot pytz --break-system-packages \
    && curl -fsSL https://deb.nodesource.com/setup_22.x | bash - \
    && apt install -y nodejs \
    && npm install -g npm@latest \
    && npm install hpack https commander colors socks axios express \
    && npm install -g cloudflared \
    && apt clean \
    && rm -rf /var/lib/apt/lists/*

# Tạo thư mục làm việc
WORKDIR /api

# Copy các file cần thiết vào VM
COPY api.js .
COPY prxscan.py .
COPY list.txt .
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf

# Cấp quyền thực thi cho các script
RUN chmod +x /api/api.js /api/prxscan.py

# Chạy supervisord khi VM khởi động
CMD ["supervisord", "-c", "/etc/supervisor/conf.d/supervisord.conf"]
